---
title: "retina"
author: "yincy"
date: "3/12/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, message=FALSE}
library(DBI)
library(GEOmetadb)
library(tidyverse)
```


```{r}
con <- dbConnect(drv = SQLite(), dbname = "/home/yincy/git/Data/GEOmetadb.sqlite")
```

```{r}
knitr::include_graphics(path = "/home/yincy/git/Bioconductor/SQL/GEOmetadb/figures/GEOmetadb.png")
```

```{r}
sql <- paste("select gse.gse, gse.title, gse.summary, 
             gsm.description,  
             gpl.gpl, gsm.molecule_ch1, 
             gse.pubmed_id",  
        "from gse", 
        "join gsm on gsm.gsm=gse_gsm.gsm", 
        "join gse_gsm on gse_gsm.gse=gse.gse",
        "join gpl on gpl.gpl=gds.gpl", 
        "join gds on gds.gse=gse.gse", 
        "where gsm.organism_ch1 = 'Homo sapiens'",
        "and gsm.molecule_ch1 in ('total RNA', 'genomic DNA', 'polyA RNA')",
        "and gpl.technology='high-throughput sequencing'",
        sep = " ")
```

```{r}
dbReadTable(con, "gpl") %>% pull(technology) %>% table() %>% sort(decreasing = T)
```

```{r}
dbReadTable(con, "gsm") %>% 
    group_by(molecule_ch1, organism_ch1) %>% 
    mutate(n = n())%>% 
    select(molecule_ch1, organism_ch1, n) %>% 
    filter(molecule_ch1 %in% c("total RNA", "genomic DNA", "polyA RNA", "nuclear RNA"), organism_ch1 == "Homo sapiens") %>% 
    distinct(molecule_ch1, organism_ch1, .keep_all = T)
```


```{r}
hsa_retina_ngs <- dbGetQuery(conn = con, statement = sql)

colnames(hsa_retina_ngs)
f1 <- hsa_retina_ngs %>% 
    filter(molecule_ch1 %in% c("total RNA", "genomic DNA", "polyA RNA"), 
           technology == "high-throughput sequencing")
f1[grepl("retina", f1$summary, ignore.case = T), ]
```

```{r}
str_split(sql, pattern = " ")
```








