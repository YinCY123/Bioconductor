---
title: "GEOmetadb"
author: "yincy"
date: "3/27/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r,message=FALSE, warning=FALSE}
library(GEOmetadb)
library(DBI)
library(RSQLite)
library(tidyverse)
```


```{r}
con <- dbConnect(drv = RSQLite::SQLite(), "f:/git/Data/GEOmetadb.sqlite")
```

```{r}
dbListFields(con, "gsm")
```

```{r}
dbReadTable()
```



```{r}
hsa_retina_ngs <- dbGetQuery(conn = con, 
           statement = "select gse.gse, gsm.title, gse.summary, 
           gse.pubmed_id, gpl.gpl, gpl.technology, gsm.gsm, 
           gsm.source_name_ch1, gsm.organism_ch1, gsm.molecule_ch1
           from gsm 
           join gse_gsm on gsm.gsm=gse_gsm.gsm 
           join gse on gse_gsm.gse=gse.gse 
           join gse_gpl on gse_gpl.gse=gse.gse 
           join gpl on gse_gpl.gpl=gpl.gpl 
           where gsm.organism_ch1 = 'Homo sapiens' 
           and gpl.technology='high-throughput sequencing'")
```


```{r}
hsa_retina_ngs %>% 
    filter((grepl("retina", title) | grepl("retina", summary) | grepl("retina", source_name_ch1)) & technology == "high-throughput sequencing") %>% 
    filter(grepl("(AMD)|(Age-related macular degeneration)|(Age related macular degeneration)", summary)) %>% 
    pull(gse) %>% 
    unique()
```











